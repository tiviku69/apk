<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediaKu - Pemutar Terpadu (Scroll Daftar)</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* CSS Terpadu - Tema Gelap dan Layout Scroll */
        :root {
            --primary-color: #BB86FC; /* Ungu terang */
            --secondary-color: #03DAC6; /* Cyan */
            --background-color: #121212; /* Latar belakang gelap */
            --surface-color: #1E1E1E; /* Permukaan elemen gelap */
            --text-color: #E0E0E0; 
            --text-secondary-color: #B0B0B0; 
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%; /* Mengisi 100% tinggi viewport */
            overflow: hidden; /* Mencegah scroll pada halaman utama */
            font-family: 'Roboto', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            -webkit-tap-highlight-color: transparent; 
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 0; 
        }

        /* Header Aplikasi */
        .app-header {
            background-color: var(--surface-color);
            color: var(--text-color);
            padding: 16px 20px;
            box-shadow: var(--card-shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0; 
            width: 100%;
            z-index: 10;
        }

        .app-header h1 { 
            font-size: 1.8em; 
            color: var(--primary-color);
        }

        /* 1. Pemutar Media & Pencarian (Kontainer Statis) */
        .static-area {
            padding: 20px;
            flex-shrink: 0;
        }

        #mediaPlayerSection {
            background-color: var(--surface-color);
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            padding: 15px; /* Padding sedikit dikurangi */
            margin-bottom: 15px; /* Jarak sedikit dikurangi */
            display: flex; 
            flex-direction: column;
            align-items: center;
        }

        #currentMediaTitlePlayer {
            font-size: 1.2em; /* Ukuran font sedikit dikecilkan */
            font-weight: 500;
            margin-bottom: 10px; /* Margin dikurangi */
            text-align: center;
            color: var(--primary-color);
            width: 100%;
        }

        /* Visualizer - HEIGHT DIKECILKAN */
        #audioVisualizer {
            width: 100%;
            height: 80px; /* Tinggi Visualizer (DARI 120px) */
            background-color: #000000; 
            border-radius: 8px;
            margin-bottom: 10px; /* Margin dikurangi */
        }

        /* Time & Controls */
        .time-container {
            width: 100%;
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: var(--text-secondary-color); 
            margin-bottom: 15px; /* Margin dikurangi */
        }
        
        .custom-controls {
            display: flex;
            justify-content: center;
            gap: 20px; /* Jarak antar kontrol dikurangi */
        }

        .control-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px; /* Ukuran tombol sedikit dikecilkan */
            height: 45px; 
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
            transition: transform 0.1s;
        }

        .main-control {
            width: 60px; /* Ukuran tombol utama dikecilkan */
            height: 60px;
            font-size: 1.8em; /* Ukuran ikon utama dikecilkan */
        }

        /* Pencarian */
        .search-box {
            display: flex;
            align-items: center;
            background-color: var(--surface-color);
            border-radius: 25px;
            padding: 8px 15px;
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
        }

        #searchInput {
            border: none;
            outline: none;
            flex-grow: 1;
            padding: 5px;
            font-size: 1em;
            background-color: transparent;
            color: var(--text-color);
        }

        #searchInput::placeholder {
            color: var(--text-secondary-color);
        }

        .search-icon {
            color: var(--primary-color);
            cursor: pointer;
        }
        
        /* 2. Daftar Media (AREA SCROLL) */
        .media-list-container {
            flex-grow: 1; 
            overflow-y: auto; 
            padding: 0 20px 20px;
        }

        .media-list-container h2 {
            margin-bottom: 10px;
            color: var(--text-color);
        }
        
        .media-list { list-style: none; }

        .media-list li {
            background-color: var(--surface-color);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s;
            color: var(--text-color);
        }

        .media-list li:hover { background-color: #333; }
    </style>
</head>
<body>
    <div class="container">
        <header class="app-header">
            <h1>pasTipas Media</h1>
        </header>

        <div class="static-area">
            <section id="mediaPlayerSection">
                <h2 id="currentMediaTitlePlayer">Pilih musik di bawah...</h2>
                
                <audio id="mediaPlayer" src="" style="display:none;"></audio> 
                
                <canvas id="audioVisualizer"></canvas>
                
                <div class="time-container">
                    <span id="currentTime">0:00</span>
                    <span id="durationTime">0:00</span>
                </div>
                
                <div class="custom-controls">
                    <button id="playPauseBtn" class="control-btn main-control" disabled>
                        <span class="material-icons">play_arrow</span>
                    </button>
                </div>
            </section>
            
            <section class="search-bar-container">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Cari musik...">
                    <span class="material-icons search-icon">search</span>
                </div>
            </section>
        </div>

        <section class="media-list-container">
            <h2>Daftar Musik</h2>
            <ul id="mediaList" class="media-list">
                <li data-type="mp3" data-url="BKBP.mp3" data-title="pasTipas-BKBP (bersamanya kau bawa pergi)">
                    <span class="material-icons">audiotrack</span>
                    pastipas BKBP <small>(MP3)</small>
                </li>
                <li data-type="mp3" data-url="indah.mp3" data-title="pasTipas-indah">
                    <span class="material-icons">music_note</span>
                    pasTipas indah <small>(MP3)</small>
                </li>
                <li data-type="mp3" data-url="lebay.mp3" data-title="pasTipas-lebay">
                    <span class="material-icons">music_note</span>
                    pasTipas lebay <small>(MP3)</small>
                </li>
                
            </ul>
        </section>
    </div>

    <script>
        // JavaScript (Tidak ada perubahan pada logika)
        document.addEventListener('DOMContentLoaded', () => {
            // Deklarasi Elemen
            const mediaList = document.getElementById('mediaList');
            const searchInput = document.getElementById('searchInput');
            const mediaPlayer = document.getElementById('mediaPlayer');
            const currentMediaTitlePlayer = document.getElementById('currentMediaTitlePlayer');
            const playPauseBtn = document.getElementById('playPauseBtn');
            const playPauseIcon = playPauseBtn.querySelector('.material-icons');
            const currentTimeSpan = document.getElementById('currentTime');
            const durationTimeSpan = document.getElementById('durationTime');
            const visualizerCanvas = document.getElementById('audioVisualizer');
            const ctx = visualizerCanvas.getContext('2d');

            // Web Audio API Global Variables
            let audioCtx;
            let analyser;
            let source;
            let bufferLength;
            let dataArray;
            let animationFrameId;
            let mediaLoaded = false; 

            // --- FUNGSI UTILITAS & VISUALIZER ---

            const formatTime = (seconds) => {
                const min = Math.floor(seconds / 60);
                const sec = Math.floor(seconds % 60);
                return `${min}:${sec < 10 ? '0' : ''}${sec}`;
            };

            const drawVisualizer = () => {
                animationFrameId = requestAnimationFrame(drawVisualizer);
                
                if (!analyser || !dataArray) return;

                analyser.getByteFrequencyData(dataArray); 

                ctx.clearRect(0, 0, visualizerCanvas.width, visualizerCanvas.height); 

                const barWidth = (visualizerCanvas.width / bufferLength) * 2.5; 
                let x = 0;

                for (let i = 0; i < bufferLength; i++) {
                    let barHeight = dataArray[i] / 2.5; 
                    
                    const hue = i / bufferLength * 360; 
                    ctx.fillStyle = `hsl(${hue}, 100%, 60%)`; 
                    
                    ctx.shadowBlur = 5;
                    ctx.shadowColor = ctx.fillStyle;

                    ctx.fillRect(x, visualizerCanvas.height - barHeight, barWidth, barHeight);

                    x += barWidth + 1; 
                }
                ctx.shadowBlur = 0; 
            };

            const initAudioContext = () => {
                if (!audioCtx) {
                    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    analyser = audioCtx.createAnalyser();
                    source = audioCtx.createMediaElementSource(mediaPlayer); 
                    source.connect(analyser);
                    analyser.connect(audioCtx.destination);

                    analyser.fftSize = 256; 
                    bufferLength = analyser.frequencyBinCount; 
                    dataArray = new Uint8Array(bufferLength);
                }
            };

            const startVisualizer = () => {
                initAudioContext();
                if (audioCtx.state === 'suspended') {
                    audioCtx.resume();
                }
                visualizerCanvas.width = visualizerCanvas.offsetWidth;
                visualizerCanvas.height = visualizerCanvas.offsetHeight;
                drawVisualizer();
            };

            const stopVisualizer = () => {
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                }
            };


            // --- EVENT LISTENERS FUNGSI ---

            // Logika filter pencarian
            const filterList = (searchTerm) => {
                const items = mediaList.querySelectorAll('li');
                const term = searchTerm.toLowerCase();

                items.forEach(item => {
                    const title = item.getAttribute('data-title').toLowerCase();
                    if (title.includes(term)) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
            };

            searchInput.addEventListener('input', (e) => {
                filterList(e.target.value);
            });

            // Logika memuat dan memutar media saat item diklik
            mediaList.addEventListener('click', (e) => {
                const listItem = e.target.closest('li');
                if (listItem && listItem.getAttribute('data-type') === 'mp3') { 
                    const mediaUrl = listItem.getAttribute('data-url');
                    const mediaTitle = listItem.getAttribute('data-title');
                    
                    currentMediaTitlePlayer.textContent = mediaTitle;
                    mediaPlayer.src = mediaUrl;
                    mediaPlayer.load(); 
                    
                    playPauseBtn.disabled = false; 

                    mediaPlayer.play().then(() => {
                        mediaLoaded = true;
                        playPauseIcon.textContent = 'pause';
                        startVisualizer();
                    }).catch(error => {
                        mediaLoaded = true;
                        console.error("Gagal memutar media:", error);
                        alert("Browser memblokir Autoplay. Silakan sentuh tombol play untuk memulai.");
                        playPauseIcon.textContent = 'play_arrow';
                        stopVisualizer();
                    });
                }
            });

            // LOGIKA WAKTU PUTAR
            mediaPlayer.addEventListener('loadedmetadata', () => {
                const duration = mediaPlayer.duration;
                durationTimeSpan.textContent = isFinite(duration) && duration > 0 ? formatTime(duration) : '0:00';
                currentTimeSpan.textContent = formatTime(0); 
            });
            
            mediaPlayer.addEventListener('timeupdate', () => {
                currentTimeSpan.textContent = formatTime(mediaPlayer.currentTime);
            });
            
            // LOGIKA PLAY/PAUSE
            playPauseBtn.addEventListener('click', () => {
                if (!mediaLoaded) {
                    alert('Silakan pilih musik dari daftar di bawah terlebih dahulu.');
                    return;
                }
                
                if (mediaPlayer.paused) {
                    mediaPlayer.play().then(() => {
                        playPauseIcon.textContent = 'pause';
                        startVisualizer();
                    }).catch(error => {
                        alert("Gagal memutar. Perlu interaksi pengguna.");
                    });
                } else {
                    mediaPlayer.pause();
                    playPauseIcon.textContent = 'play_arrow';
                    stopVisualizer();
                }
            });

            mediaPlayer.addEventListener('ended', () => {
                playPauseIcon.textContent = 'play_arrow';
                stopVisualizer();
                currentTimeSpan.textContent = formatTime(0); 
            });

            // Mengatur ulang visualizer saat ukuran jendela berubah (untuk responsivitas)
            window.addEventListener('resize', () => {
                if (mediaLoaded || !mediaPlayer.paused) {
                    visualizerCanvas.width = visualizerCanvas.offsetWidth;
                    visualizerCanvas.height = visualizerCanvas.offsetHeight;
                    if (animationFrameId) {
                        cancelAnimationFrame(animationFrameId);
                        drawVisualizer();
                    }
                }
            });
            
            // Inisialisasi ukuran visualizer saat dimuat
             window.addEventListener('load', () => {
                visualizerCanvas.width = visualizerCanvas.offsetWidth;
                visualizerCanvas.height = visualizerCanvas.offsetHeight;
             });
        });
    </script>
</body>
</html>
