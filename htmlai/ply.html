<!DOCTYPE html>
<html lang="in">
<head>
    <meta charset="UTF-8">
    <title>Video Player | Plyr HLS (Remote Ready)</title>
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <style>
        /* Gaya dasar untuk Plyr agar mengisi layar, ideal untuk TV */
        body { 
            background-color: #000; 
            margin: 0; 
            padding: 0; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh;
        }
        .container { 
            width: 100%; 
            max-width: 1280px; 
        }
        /* PENYESUAIAN PENTING: Gaya untuk fokus (border) agar terlihat jelas di TV */
        .plyr--full-ui button:focus, .plyr--full-ui input[type=range]:focus, .plyr--full-ui a:focus, .plyr__control:focus { 
            outline: none; 
            box-shadow: 0 0 0 3px #00a4ff; /* Border biru terang saat terfokus */
        }
    </style>
</head>
<body>
    <div class="container">
        <video id="player" controls crossorigin playsinline></video>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const video = document.getElementById('player');
            const videoSource = sessionStorage.getItem('videoLink'); 
            const videoTitle = sessionStorage.getItem('videoTitle'); 
            
            if (videoTitle) {
                document.title = videoTitle + ' | Plyr HLS';
            }

            if (!videoSource) {
                video.style.display = 'none';
                alert('Tautan video tidak ditemukan. Kembali ke halaman utama.');
                window.location.href = 'index.html';
                return;
            }

            const defaultOptions = {}; 

            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(videoSource);
                hls.attachMedia(video);

                hls.on(Hls.Events.MANIFEST_PARSED, function () {
                    const player = new Plyr(video, defaultOptions);
                    setupAndroidTVRemote(player); 
                    player.play(); 
                });
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = videoSource;
                const player = new Plyr(video, defaultOptions);
                setupAndroidTVRemote(player);
                player.play();
            } else {
                console.error('HLS tidak didukung di browser ini.');
                video.style.display = 'none';
                alert('HLS tidak didukung di browser Anda.');
            }
        });

        // --- Fungsi untuk Menangani Input Remote Android TV agar tombol Plyr dapat dinavigasi ---
        function setupAndroidTVRemote(player) {
            // Pastikan kontainer Plyr dapat difokus
            player.elements.container.tabIndex = 0; 
            player.elements.container.focus(); // Berikan fokus awal

            // KeyCodes standar Android TV Remote D-pad
            const KEY_CENTER = 13;   // Enter / Center D-pad (Play/Pause/OK)
            const KEY_LEFT = 37;     // Left D-pad (Seek Backward)
            const KEY_RIGHT = 39;    // Right D-pad (Seek Forward)
            const KEY_UP = 38;       // Up D-pad
            const KEY_DOWN = 40;     // Down D-pad
            const seekStep = 10;     // Maju/mundur 10 detik

            document.addEventListener('keydown', (event) => {
                const isDpadOrCenter = [KEY_CENTER, KEY_LEFT, KEY_RIGHT, KEY_UP, KEY_DOWN].includes(event.keyCode);
                const isFocusedOnControl = player.elements.controls.contains(document.activeElement);

                if (isDpadOrCenter) {
                    // 1. Selalu tampilkan kontrol saat D-pad ditekan untuk memungkinkan navigasi.
                    player.toggleControls(true); 
                    event.preventDefault(); 
                }
                
                // 2. Terapkan Play/Pause dan Seek Cepat (FF/RW) saat tombol Left/Right/Center ditekan 
                //    DAN fokus TIDAK berada di dalam kontrol Plyr (untuk menghindari bentrok dengan navigasi).
                if (!isFocusedOnControl) {
                    switch (event.keyCode) {
                        case KEY_CENTER:
                            // Play/Pause cepat saat Center ditekan dan tidak ada tombol yang difokus
                            if (player.playing) {
                                player.pause();
                            } else {
                                player.play();
                            }
                            break;
                        case KEY_LEFT:
                            // Seek Backward
                            player.currentTime = player.currentTime - seekStep;
                            break;
                        case KEY_RIGHT:
                            // Seek Forward
                            player.currentTime = player.currentTime + seekStep;
                            break;
                    }
                }

                // Untuk tombol KEY_UP/KEY_DOWN/KEY_LEFT/KEY_RIGHT, setelah kontrol muncul (langkah 1), 
                // perilaku navigasi default D-pad (seperti tombol Tab) akan mengambil alih, 
                // memungkinkan pengguna memindahkan fokus dari satu tombol Plyr ke tombol lainnya.
            });
        }
    </script>
</body>
</html>